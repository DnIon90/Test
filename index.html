<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Ferma Avansat캒 a lui Ion</title>
<style>
body{font-family:Arial,sans-serif;background:#d0f0c0;margin:0;padding:20px;}
h1,h2,h3{color:#2e7d32;margin:5px 0;}
input,button,select{padding:6px;border-radius:5px;border:1px solid #ccc;font-size:14px;}
button{background:#2e7d32;color:#fff;border:0;cursor:pointer;}
button:hover{background:#1b5e20;}
.muted{color:#666;font-size:13px;}
#login-area,#farm-area,#admin-area,#shop-area,#leaderboard-area{margin-bottom:20px;}
#plots{display:flex;gap:5px;flex-wrap:wrap;margin:10px 0;}
.plot{width:60px;height:60px;background:#a0522d;border-radius:4px;display:flex;align-items:center;justify-content:center;color:#fff;cursor:pointer;position:relative;font-weight:bold;}
.plot img{width:90%;height:90%;display:block;margin:auto;}
.plot span{position:absolute;bottom:0;font-size:11px;color:#000;}
.plot.planted{background:#fdd835;}
.plot.ready{background:#4caf50;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
table,th,td{border:1px solid #ccc;}
th,td{padding:6px;text-align:center;}
.admin-btn{background:#d32f2f;}
.first-place{background:gold;}
#animals-list img{width:40px;height:40px;margin:2px;}
#guards{margin:10px 0;}
#guards img{width:40px;height:40px;margin-right:5px;}
</style>
</head>
<body>
<h1>游 Ferma Avansat캒 a lui Ion</h1>

<!-- LOGIN / REGISTER -->
<div id="login-area">
  <div id="not-logged">
    <input id="login-username" placeholder="Username"><br><br>
    <input id="login-password" placeholder="Parol캒" type="password"><br><br>
    <button id="login-btn">Logheaz캒</button>
    <button id="show-register-btn" style="background:#388e3c">칉nregistreaz캒</button>
    <div id="register-area" style="display:none;margin-top:10px;">
      <input id="reg-username" placeholder="Username"><br><br>
      <input id="reg-password" placeholder="Parol캒" type="password"><br><br>
      <button id="register-btn">Creeaz캒 cont</button>
      <button id="cancel-register">Anuleaz캒</button>
      <div id="reg-msg" class="muted"></div>
    </div>
  </div>
  <div id="logged" style="display:none;">
    <p class="muted">Logat ca <strong id="me-username"></strong></p>
    <button id="logout-btn">Deconecteaz캒</button>
  </div>
</div>

<!-- FARM AREA -->
<div id="farm-area" style="display:none;">
  <h2>游뿺 Parcela ta de p캒m칙nt</h2>
  <div id="guards">
    <img src="https://i.imgur.com/5X3PnDz.png" title="Paznic 1">
    <img src="https://i.imgur.com/5X3PnDz.png" title="Paznic 2">
  </div>
  <button id="tractor-btn">游뚶 Recolteaz캒 toate plantele gata</button>
  <div class="muted" id="farm-level">Nivel ferm캒: 1</div>
  <div id="plots"></div>
  <h3>Resurse colectate</h3>
  <div>游 Gr칙u: <span id="grain-count">0</span></div>
  <div>游볫 Legume: <span id="veg-count">0</span></div>
  <div>游꼝 Fructe: <span id="fruit-count">0</span></div>
  <div>游 Pomi: <span id="tree-count">0</span></div>
  <div>游눯 Monede: <span id="coins-count">0</span></div>
</div>

<!-- SHOP AREA -->
<div id="shop-area" style="display:none;">
  <h2>游 Magazin</h2>
  <button onclick="buyPlant('Gr칙u',5)">Cump캒r캒 Gr칙u (5 monede)</button>
  <button onclick="buyPlant('Legume',7)">Cump캒r캒 Legume (7 monede)</button>
  <button onclick="buyPlant('Fructe',10)">Cump캒r캒 Fructe (10 monede)</button>
  <button onclick="buyPlant('Pom',20)">Cump캒r캒 Pom (20 monede)</button>
  <button onclick="sellAll()">Vinde toat캒 recolta</button>
  <h3>Animale</h3>
  <button onclick="buyAnimal('Vac캒',15)">Cump캒r캒 Vac캒 (15 monede)</button>
  <button onclick="buyAnimal('G캒in캒',5)">Cump캒r캒 G캒in캒 (5 monede)</button>
  <div id="animals-list"></div>
</div>

<script>
// ===== SHA-256 =====
async function sha256(str){
  const buf = new TextEncoder().encode(str);
  const hash = await crypto.subtle.digest('SHA-256', buf);
  return Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,'0')).join('');
}

// ===== LocalStorage =====
const STORAGE_USERS = 'farm_users_full';
function loadUsers(){ return JSON.parse(localStorage.getItem(STORAGE_USERS)||'{}'); }
function saveUsers(u){ localStorage.setItem(STORAGE_USERS, JSON.stringify(u)); }

// ===== UI Elements =====
const loginUsername=document.getElementById('login-username');
const loginPassword=document.getElementById('login-password');
const loginBtn=document.getElementById('login-btn');
const showRegBtn=document.getElementById('show-register-btn');
const registerArea=document.getElementById('register-area');
const regUsername=document.getElementById('reg-username');
const regPassword=document.getElementById('reg-password');
const registerBtn=document.getElementById('register-btn');
const cancelRegister=document.getElementById('cancel-register');
const regMsg=document.getElementById('reg-msg');
const notLoggedDiv=document.getElementById('not-logged');
const loggedDiv=document.getElementById('logged');
const meUsernameEl=document.getElementById('me-username');
const logoutBtn=document.getElementById('logout-btn');
const farmArea=document.getElementById('farm-area');
const shopArea=document.getElementById('shop-area');
const plotsDiv=document.getElementById('plots');
const grainCount=document.getElementById('grain-count');
const vegCount=document.getElementById('veg-count');
const fruitCount=document.getElementById('fruit-count');
const treeCount=document.getElementById('tree-count');
const coinsCount=document.getElementById('coins-count');
const animalsListDiv=document.getElementById('animals-list');
const tractorBtn=document.getElementById('tractor-btn');

let currentUser=null;
let userData={grain:0,veg:0,fruit:0,tree:0,coins:0,plots:[],animals:[],farmLevel:1};
const plantTimes={'Gr칙u':10,'Legume':15,'Fructe':20,'Pom':30};
const plantImgs={'Gr칙u':'https://i.imgur.com/7bM9a5K.png','Legume':'https://i.imgur.com/Hu2z0kX.png','Fructe':'https://i.imgur.com/59lX4cP.png','Pom':'https://i.imgur.com/l0bKZlQ.png'};
const animalImgs={'Vac캒':'https://i.imgur.com/4L3QZlP.png','G캒in캒':'https://i.imgur.com/Ms5aK8y.png'};

// ===== REGISTER =====
showRegBtn.addEventListener('click',()=>{registerArea.style.display='block';});
cancelRegister.addEventListener('click',()=>{registerArea.style.display='none'; regMsg.textContent='';});
registerBtn.addEventListener('click', async ()=>{
  const u=regUsername.value.trim(); const p=regPassword.value;
  if(!u||!p){ regMsg.textContent='Completeaz캒 toate c칙mpurile!'; return;}
  const users=loadUsers();
  if(users[u]){ regMsg.textContent='Username deja folosit!'; return;}
  const hash=await sha256(p);
  const plots=Array.from({length:9},()=>({type:null,ready:false,plantedAt:null}));
  users[u]={passHash:hash,coins:20,grain:0,veg:0,fruit:0,tree:0,plots:plots,animals:[],farmLevel:1};
  saveUsers(users);
  regMsg.textContent='Cont creat! Te po탵i loga.';
  regUsername.value=''; regPassword.value=''; registerArea.style.display='none';
});

// ===== LOGIN =====
loginBtn.addEventListener('click', async ()=>{
  const u=loginUsername.value.trim(); const p=loginPassword.value;
  if(!u||!p){alert('Completeaz캒 username 탳i parol캒!'); return;}
  const users=loadUsers();
  if(!users[u]){alert('Utilizator inexistent!'); return;}
  const hash=await sha256(p);
  if(hash!==users[u].passHash){alert('Parol캒 gre탳it캒!'); return;}
  currentUser=u; userData=JSON.parse(JSON.stringify(users[u]));
  localStorage.setItem('currentUser',currentUser);
  onLogin();
  loginUsername.value=''; loginPassword.value='';
});

logoutBtn.addEventListener('click',()=>{
  currentUser=null; localStorage.removeItem('currentUser');
  notLoggedDiv