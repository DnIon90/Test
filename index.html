<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ferma Online Ultra Avansată</title>
<style>
body{font-family:Arial,sans-serif;background:#d0f0c0;margin:0;padding:20px;}
h1,h2,h3{color:#2e7d32;margin:5px 0;}
input,button,select{padding:6px;margin:2px;border-radius:5px;border:1px solid #ccc;}
button{background:#2e7d32;color:#fff;cursor:pointer;}
button:hover{background:#1b5e20;}
.muted{color:#666;font-size:13px;}
#plots{display:flex;flex-wrap:wrap;gap:5px;margin:10px 0;}
.plot{width:60px;height:60px;background:#a0522d;border-radius:4px;display:flex;align-items:center;justify-content:center;cursor:pointer;position:relative;}
.plot img{width:90%;height:90%;}
.plot span{position:absolute;bottom:0;font-size:11px;color:#000;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
table,th,td{border:1px solid #ccc;}
th,td{padding:4px;text-align:center;}
.admin-btn{background:#d32f2f;color:#fff;}
#animals-list img{width:40px;height:40px;margin:2px;}
#shop-area,#farm-area,#admin-area,#leaderboard-area{margin-bottom:20px;}
</style>
</head>
<body>
<h1>🌾 Ferma Online Ultra Avansată</h1>

<!-- LOGIN -->
<div id="login-area">
  <div id="not-logged">
    <input id="login-username" placeholder="Username"><br>
    <input id="login-password" placeholder="Parolă" type="password"><br>
    <button id="login-btn">Loghează</button>
    <button id="show-register-btn">Înregistrează</button>
    <div id="register-area" style="display:none;margin-top:10px;">
      <input id="reg-username" placeholder="Username"><br>
      <input id="reg-password" placeholder="Parolă" type="password"><br>
      <button id="register-btn">Creează cont</button>
      <button id="cancel-register">Anulează</button>
      <div id="reg-msg" class="muted"></div>
    </div>
  </div>
  <div id="logged" style="display:none;">
    <p>Logat ca <strong id="me-username"></strong></p>
    <button id="logout-btn">Deconectează</button>
  </div>
</div>

<!-- FARM -->
<div id="farm-area" style="display:none;">
<h2>🪴 Ferma ta</h2>
<button id="tractor-btn">🚜 Recoltează toate plantele gata</button>
<button id="semanatoare-btn">🌱 Plantează automat în loturile goale</button>
<div id="plots"></div>
<h3>Resurse colectate</h3>
<div>🌾 Grâu: <span id="grain-count">0</span></div>
<div>🌽 Porumb: <span id="corn-count">0</span></div>
<div>🍎 Mere: <span id="apple-count">0</span></div>
<div>🍊 Portocale: <span id="orange-count">0</span></div>
<div>🍋 Lămâi: <span id="lemon-count">0</span></div>
<div>💰 Monede: <span id="coins-count">0</span></div>
<h3>Animale</h3>
<div id="animals-list"></div>
<h3>Paznici</h3>
<div id="guards-count">0</div>
</div>

<!-- SHOP -->
<div id="shop-area" style="display:none;">
<h2>🛒 Magazin</h2>
<button onclick="buyAnimal('Câine',5)">Cumpără Câine (5 monede)</button>
<button onclick="buyAnimal('Pisică',5)">Cumpără Pisică (5 monede)</button>
<button onclick="buyAnimal('Vacă',10)">Cumpără Vacă (10 monede)</button>
<button onclick="buyAnimal('Găină',5)">Cumpără Găină (5 monede)</button>
<button onclick="buyAnimal('Pește',3)">Cumpără Pește (3 monede)</button>
<br><br>
<button onclick="buyGuard(5)">Cumpără Paznic (5 monede)</button>
<br><br>
<h3>Vinde produse</h3>
<button onclick="sellProduct('Grâu')">Vinde Grâu</button>
<button onclick="sellProduct('Porumb')">Vinde Porumb</button>
<button onclick="sellProduct('Mere')">Vinde Mere</button>
<button onclick="sellProduct('Portocale')">Vinde Portocale</button>
<button onclick="sellProduct('Lămâi')">Vinde Lămâi</button>
<br><br>
<h3>Loturi de pământ</h3>
<button onclick="buyPlot(10)">Cumpără lot (+1, 10 monede)</button>
<button onclick="sellPlot(5)">Vinde lot (-1, +5 monede)</button>
</div>

<!-- LEADERBOARD -->
<div id="leaderboard-area" style="display:none;">
<h2>🏆 Leaderboard</h2>
<table>
<thead><tr><th>Loc</th><th>Username</th><th>Monede</th></tr></thead>
<tbody id="leaderboard-table"></tbody>
</table>
</div>

<script>
// SHA-256
async function sha256(str){const buf=new TextEncoder().encode(str);const hash=await crypto.subtle.digest('SHA-256', buf);return Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,'0')).join('');}

// LocalStorage
const STORAGE_USERS='farm_users';
function loadUsers(){return JSON.parse(localStorage.getItem(STORAGE_USERS)||'{}');}
function saveUsers(u){localStorage.setItem(STORAGE_USERS,JSON.stringify(u));}

// UI
const loginUsername=document.getElementById('login-username');
const loginPassword=document.getElementById('login-password');
const loginBtn=document.getElementById('login-btn');
const showRegBtn=document.getElementById('show-register-btn');
const registerArea=document.getElementById('register-area');
const regUsername=document.getElementById('reg-username');
const regPassword=document.getElementById('reg-password');
const registerBtn=document.getElementById('register-btn');
const cancelRegister=document.getElementById('cancel-register');
const regMsg=document.getElementById('reg-msg');
const notLoggedDiv=document.getElementById('not-logged');
const loggedDiv=document.getElementById('logged');
const meUsernameEl=document.getElementById('me-username');
const logoutBtn=document.getElementById('logout-btn');
const farmArea=document.getElementById('farm-area');
const shopArea=document.getElementById('shop-area');
const plotsDiv=document.getElementById('plots');
const grainCount=document.getElementById('grain-count');
const cornCount=document.getElementById('corn-count');
const appleCount=document.getElementById('apple-count');
const orangeCount=document.getElementById('orange-count');
const lemonCount=document.getElementById('lemon-count');
const coinsCount=document.getElementById('coins-count');
const animalsListDiv=document.getElementById('animals-list');
const tractorBtn=document.getElementById('tractor-btn');
const semanatoareBtn=document.getElementById('semanatoare-btn');
const leaderboardTable=document.getElementById('leaderboard-table');
const guardsCountDiv=document.getElementById('guards-count');

let currentUser=null;
let userData=null;

// Plants and animals
const plantTimes={'Grâu':10,'Porumb':15,'Mere':20,'Portocale':20,'Lămâi':25};
const plantImgs={'Grâu':'https://i.imgur.com/7bM9a5K.png','Porumb':'https://i.imgur.com/fy7T6oN.png','Mere':'https://i.imgur.com/3e6Qm7l.png','Portocale':'https://i.imgur.com/Zv4Q07V.png','Lămâi':'https://i.imgur.com/8GrH1Ha.png'};
const animalImgs={'Câine':'https://i.imgur.com/1CwZJ6F.png','Pisică':'https://i.imgur.com/Ms5aK8y.png','Vacă':'https://i.imgur.com/4L3QZlP.png','Găină':'https://i.imgur.com/3bGqR9F.png','Pește':'https://i.imgur.com/BxH1pI9.png'};

// Register
showRegBtn.addEventListener('click',()=>{registerArea.style.display='block';});
cancelRegister.addEventListener('click',()=>{registerArea.style.display='none'; regMsg.textContent='';});
registerBtn.addEventListener('click', async ()=>{
  const u=regUsername.value.trim(); const p=regPassword.value;
  if(!u||!p){ regMsg.textContent='Completează toate câmpurile!'; return;}
  const users=loadUsers();
  if(users[u]){ regMsg.textContent='Username deja folosit!'; return;}
  const hash=await sha256(p);
  const plots=Array(9).fill().map(()=>({type:null,plantedAt:null,ready:false}));
  users[u]={passHash:hash,coins:20,grain:0,corn:0,apple:0,orange:0,lemon:0,plots:plots,animals:[],guards:0};
  saveUsers(users);
  regMsg.textContent='Cont creat! Poți să te loghezi.'; regUsername.value=''; regPassword.value=''; registerArea.style.display='none';
});

// Login