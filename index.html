<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<title>Ferma Avansată - Test Login</title>
<style>
body{font-family:Arial,sans-serif;background:#d0f0c0;padding:20px;}
input,button{padding:6px;margin:3px;}
button{cursor:pointer;}
#welcome-div{display:none;}
</style>
</head>
<body>

<h1>Ferma Avansată - Login / Registrare</h1>

<div id="register-div">
  <h3>Înregistrează</h3>
  <input id="reg-user" placeholder="Username"><br>
  <input id="reg-pass" placeholder="Parolă" type="password"><br>
  <button id="reg-btn">Creează cont</button>
  <p id="reg-msg" style="color:green;"></p>
</div>

<div id="login-div">
  <h3>Login</h3>
  <input id="login-user" placeholder="Username"><br>
  <input id="login-pass" placeholder="Parolă" type="password"><br>
  <button id="login-btn">Loghează</button>
  <p id="login-msg" style="color:red;"></p>
</div>

<div id="welcome-div">
  <h3>Bine ai venit, <span id="user-name"></span>!</h3>
  <button id="logout-btn">Deconectează</button>
</div>

<script>
// SHA-256 pentru parolă
async function sha256(str){
  const buf=new TextEncoder().encode(str);
  const hash=await crypto.subtle.digest('SHA-256',buf);
  return Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,'0')).join('');
}

// LocalStorage
const STORAGE='farm_users_test';
function loadUsers(){ return JSON.parse(localStorage.getItem(STORAGE)||'{}'); }
function saveUsers(u){ localStorage.setItem(STORAGE,JSON.stringify(u)); }

// Registrare
document.getElementById('reg-btn').onclick=async ()=>{
  const u=document.getElementById('reg-user').value.trim();
  const p=document.getElementById('reg-pass').value;
  const msg=document.getElementById('reg-msg');
  if(!u||!p){ msg.textContent='Completează toate câmpurile!'; msg.style.color='red'; return; }
  const users=loadUsers();
  if(users[u]){ msg.textContent='Username deja folosit!'; msg.style.color='red'; return; }
  const hash=await sha256(p);
  users[u]={passHash:hash,coins:5,grain:0,veg:0,fruit:0,animals:[]};
  saveUsers(users);
  msg.textContent='Cont creat! Poți să te loghezi.';
  msg.style.color='green';
  document.getElementById('reg-user').value='';
  document.getElementById('reg-pass').value='';
}

// Login
document.getElementById('login-btn').onclick=async ()=>{
  const u=document.getElementById('login-user').value.trim();
  const p=document.getElementById('login-pass').value;
  const msg=document.getElementById('login-msg');
  const users=loadUsers();
  if(!users[u]){ msg.textContent='Utilizator inexistent'; return; }
  const hash=await sha256(p);
  if(hash!==users[u].passHash){ msg.textContent='Parolă greșită'; return; }
  // Login reușit
  document.getElementById('login-div').style.display='none';
  document.getElementById('register-div').style.display='none';
  document.getElementById('welcome-div').style.display='block';
  document.getElementById('user-name').textContent=u;
  localStorage.setItem('currentUser',u);
}

// Logout
document.getElementById('logout-btn').onclick=()=>{
  document.getElementById('login-div').style.display='block';
  document.getElementById('register-div').style.display='block';
  document.getElementById('welcome-div').style.display='none';
  localStorage.removeItem('currentUser');
}

// Auto-login dacă există sesiune
window.onload = () => {
  const savedUser = localStorage.getItem('currentUser');
  const users = loadUsers();
  if(savedUser && users[savedUser]){
    document.getElementById('login-div').style.display='none';
    document.getElementById('register-div').style.display='none';
    document.getElementById('welcome-div').style.display='block';
    document.getElementById('user-name').textContent = savedUser;
  }
}
</script>

</body>
</html>