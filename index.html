<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Ferma Animată a lui Ion</title>
<style>
body{font-family:Arial,sans-serif;background:#d0f0c0;margin:0;padding:20px;}
h1,h2,h3{color:#2e7d32;margin:5px 0;}
input,button,select{padding:6px;border-radius:5px;border:1px solid #ccc;font-size:14px;}
button{background:#2e7d32;color:#fff;border:0;cursor:pointer;}
button:hover{background:#1b5e20;}
.muted{color:#666;font-size:13px;}
#login-area,#farm-area,#admin-area,#shop-area,#leaderboard-area{margin-bottom:20px;}
#plots{display:flex;gap:5px;flex-wrap:wrap;margin:10px 0;position:relative;width:100%;}
.plot{width:60px;height:60px;background:#a0522d;border-radius:4px;display:flex;align-items:center;justify-content:center;cursor:pointer;position:relative;overflow:hidden;}
.plot .crop{width:100%;height:100%;border-radius:50%;transform:scale(0);transition: transform 1s,background 1s;}
.plot.planted .crop{background:linear-gradient(#8B4513,#FFD700);transform:scale(1);}
.plot.ready .crop{background:linear-gradient(#228B22,#ADFF2F);}
#animals-list{position:relative;width:100%;height:100px;}
.animal,.fish,.thief,.guard{font-size:28px;position:absolute;transition:left 1s, top 1s;}
#lake{width:100%;height:80px;background:lightblue;margin-top:10px;position:relative;overflow:hidden;}
.harvester,.seeder{width:25px;height:25px;position:absolute;border-radius:4px;z-index:10;transition:left 0.5s,top 0.5s;}
.harvester{background:green;}
.seeder{background:blue;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
table,th,td{border:1px solid #ccc;}
th,td{padding:6px;text-align:center;}
.admin-btn{background:#d32f2f;}
.first-place{background:gold;}
</style>
</head>
<body>
<h1>🌾 Ferma Animată a lui Ion</h1>

<!-- LOGIN / REGISTER -->
<div id="login-area">
  <div id="not-logged">
    <input id="login-username" placeholder="Username"><br><br>
    <input id="login-password" placeholder="Parolă" type="password"><br><br>
    <button id="login-btn">Loghează</button>
    <button id="show-register-btn" style="background:#388e3c">Înregistrează</button>
    <div id="register-area" style="display:none;margin-top:10px;">
      <input id="reg-username" placeholder="Username"><br><br>
      <input id="reg-password" placeholder="Parolă" type="password"><br><br>
      <select id="reg-role"><option value="user">User</option><option value="admin">Admin</option></select><br><br>
      <button id="register-btn">Creează cont</button>
      <button id="cancel-register">Anulează</button>
      <div id="reg-msg" class="muted"></div>
    </div>
  </div>
  <div id="logged" style="display:none;">
    <p class="muted">Logat ca <strong id="me-username"></strong> (<span id="me-role"></span>)</p>
    <button id="logout-btn">Deconectează</button>
  </div>
</div>

<!-- FARM AREA -->
<div id="farm-area" style="display:none;">
  <h2>🪴 Parcela ta de pământ</h2>
  <button id="tractor-btn">🚜 Recoltează toate plantele gata</button>
  <div class="muted" id="farm-level">Nivel fermă: 1</div>
  <div id="plots"></div>
  <h3>Resurse colectate</h3>
  <div>🌾 Grâu: <span id="grain-count">0</span></div>
  <div>🥕 Legume: <span id="veg-count">0</span></div>
  <div>🍎 Fructe: <span id="fruit-count">0</span></div>
  <div>💰 Monede: <span id="coins-count">0</span></div>
  <div id="animals-list"></div>
  <div id="lake"></div>
</div>

<!-- SHOP -->
<div id="shop-area" style="display:none;">
  <h2>🛒 Magazin</h2>
  <button onclick="buyAnimal('Vacă',5)">Cumpără Vacă (5 monede)</button>
  <button onclick="buyAnimal('Găină',3)">Cumpără Găină (3 monede)</button>
  <button onclick="buyAnimal('Câine',4)">Cumpără Câine (4 monede)</button>
  <button onclick="buyAnimal('Pisică',4)">Cumpără Pisică (4 monede)</button>
</div>

<!-- ADMIN -->
<div id="admin-area" style="display:none;">
  <h2>🔧 Panou Administrator & Statistici</h2>
  <table>function renderAdminTable(){
  const users = loadUsers();
  adminTable.innerHTML = '';
  Object.keys(users).forEach(u => {
    const user = users[u];
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${u}</td><td>${user.role}</td>
                    <td>${user.grain}</td><td>${user.veg}</td>
                    <td>${user.fruit}</td><td>${user.coins}</td>
                    <td>${user.farmLevel}</td>
                    <td>${user.role!=='admin'?`<button onclick="deleteUser('${u}')">Șterge</button>`:''}</td>`;
    adminTable.appendChild(tr);
  });
}
function deleteUser(u){
  if(confirm(`Ștergi utilizatorul ${u}?`)){
    const users = loadUsers();
    delete users[u];
    saveUsers(users);
    renderAdminTable();
  }
}
    <thead>
      <tr><th>Username</th><th>Rol</th><th>Grâu</th><th>Legume</th><th>Fructe</th><th>Monede</th><th>Fermă</th><th>Acțiuni</th></tr>
    </thead>
    <tbody id="admin-table"></tbody>
  </table>
</div>

<script>
//=== Logare si inregistrare ramane neschimbata ===
async function sha256Hex(str){const utf8=new TextEncoder().encode(str);const hash=await crypto.subtle.digest('SHA-256',utf8);return Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,'0')).join('');}
const STORAGE_USERS='farm_users_advanced';
function loadUsers(){return JSON.parse(localStorage.getItem(STORAGE_USERS)||'{}');}
function saveUsers(u){localStorage.setItem(STORAGE_USERS,JSON.stringify(u));}

const loginUsername=document.getElementById('login-username');
const loginPassword=document.getElementById('login-password');
const loginBtn=document.getElementById('login-btn');
const showRegBtn=document.getElementById('show-register-btn');
const registerArea=document.getElementById('register-area');
const regUsername=document.getElementById('reg-username');
const regPassword=document.getElementById('reg-password');
const regRole=document.getElementById('reg-role');
const registerBtn=document.getElementById('register-btn');
const cancelRegister=document.getElementById('cancel-register');
const regMsg=document.getElementById('reg-msg');
const notLoggedDiv=document.getElementById('not-logged');
const loggedDiv=document.getElementById('logged');
const meUsernameEl=document.getElementById('me-username');
const meRoleEl=document.getElementById('me-role');
const logoutBtn=document.getElementById('logout-btn');
const farmArea=document.getElementById('farm-area');
const shopArea=document.getElementById('shop-area');
const adminArea=document.getElementById('admin-area');
const plotsDiv=document.getElementById('plots');
const grainCount=document.getElementById('grain-count');
const vegCount=document.getElementById('veg-count');
const fruitCount=document.getElementById('fruit-count');
const coinsCount=document.getElementById('coins-count');
const adminTable=document.getElementById('admin-table');
const animalsListDiv=document.getElementById('animals-list');
const tractorBtn=document.getElementById('tractor-btn');

let currentUser=null; let currentRole=null; let userData={grain:0,veg:0,fruit:0,coins:0,plots:[],farmLevel:1,animals:[]};
const plantTimes={'Grâu':10,'Legume':15,'Fructe':20};

showRegBtn.addEventListener('click',()=>{registerArea.style.display='block';});
cancelRegister.addEventListener('click',()=>{registerArea.style.display='none'; regMsg.textContent='';});
registerBtn.addEventListener('click', async () => {
  const u = regUsername.value.trim(); const p = regPassword.value; const role = regRole.value;
  if(!u || !p){regMsg.textContent='Completează toate câmpurile!'; return;}
  const users = loadUsers();
  if(users[u]){regMsg.textContent='Username deja folosit!'; return;}
  const hash = await sha256Hex(p);
  const plots = Array(18).fill().map(()=>({type:null,plantedAt:null,ready:false}));
  users[u] = {passHash:hash,role:role,grain:0,veg:0,fruit:0,coins:0,farmLevel:1,plots:plots,animals:[]};
  saveUsers(users);
  regMsg.textContent='Cont creat! Poți să te loghezi.';
  regUsername.value=''; regPassword.value=''; registerArea.style.display='none';
});
loginBtn.addEventListener('click', async () => {
  const u = loginUsername.value.trim(); const p = loginPassword.value;
  if(!u || !p){alert('Completează username și parolă!'); return;}
  const users = loadUsers(); if(!users[u]){alert('Utilizator inexistent!'); return;}
  const hash = await sha256Hex(p);
  if(hash !== users[u].passHash){alert('Parolă greșită!'); return;}
  currentUser = u; currentRole = users[u].role; userData = JSON.parse(JSON.stringify(users[u]));
  localStorage.setItem('currentUser', currentUser);
  onLogin(); loginUsername.value=''; loginPassword.value='';
});
logoutBtn.addEventListener('click',()=>{
  currentUser=null; currentRole=null; localStorage.removeItem('currentUser');
  notLoggedDiv.style.display='block'; loggedDiv.style.display='none'; farmArea.style.display='none'; shopArea.style.display='none'; adminArea.style.display='none';
});
window.onload = () => {
  const savedUser = localStorage.getItem('currentUser');
  const users = loadUsers();
  if(savedUser && users[savedUser]){currentUser = savedUser; currentRole = users[savedUser].role; userData = JSON.parse(JSON.stringify(users[savedUser])); onLogin();}
}
function onLogin(){
  notLoggedDiv.style.display='none'; loggedDiv.style.display='block'; farmArea.style.display='block'; shopArea.style.display='block';
  meUsernameEl.textContent=currentUser; meRoleEl.textContent=currentRole;
  if(!userData.plots || userData.plots.length===0) userData.plots=Array(18).fill().map(()=>({type:null,plantedAt:null,ready:false}));
  renderFarm(); updateResourceUI(); renderAnimals();
  if(currentRole==='admin'){adminArea.style.display='block'; renderAdminTable();}
  setInterval(updateLoop,1000);
}

//=== Ferma ===
function renderFarm(){
  plotsDiv.innerHTML=''; userData.plots.forEach((p,i)=>{
    const div=document.createElement('div'); div.className='plot';
    const crop=document.createElement('div'); crop.className='crop'; div.appendChild(crop);
    if(p.type && !p.ready) div.classList.add('planted');
    if(p.ready) div.classList.add('ready');
    div.addEventListener('click',()=>{interactPlot(i);});
    plotsDiv.appendChild(div);
  });
}
function interactPlot(idx){
  const plot=userData.plots[idx];
  if(plot.ready){
    if(plot.type==='Grâu') userData.grain+=1;
    if(plot.type==='Legume') userData.veg+=1;
    if(plot.type==='Fructe') userData.fruit+=1;
    userData.coins+=1;
    plot.type=null; plot.ready=false; plot.plantedAt=null;
    saveUserData(); renderFarm(); updateResourceUI();
  } else if(!plot.type){
    const choice=prompt('Ce vrei să plantezi? Grâu / Legume / Fructe','Grâu');
    if(choice && plantTimes[choice]){
      plot.type=choice; plot.plantedAt=Date.now(); plot.ready=false;
      saveUserData(); renderFarm();
    }
  }
}
function updatePlots(){userData.plots.forEach(p=>{if(p.type && !p.ready){if(Math.floor((Date.now()-p.plantedAt)/1000)>=plantTimes[p.type]){p.ready=true;}}});}
tractorBtn.addEventListener('click',()=>{
  userData.plots.forEach(p=>{
    if(p.ready){if(p.type==='Grâu') userData.grain+=1; if(p.type==='Legume') userData.veg+=1; if(p.type==='Fructe') userData.fruit+=1; userData.coins+=1; p.type=null; p.ready=false; p.plantedAt=null;}
  }); saveUserData(); renderFarm(); updateResourceUI();
});
function buyAnimal(name,cost){if(userData.coins>=cost){userData.coins-=cost; userData.animals.push(name); saveUserData(); updateResourceUI(); renderAnimals();} else alert('Nu ai suficiente monede!');}
function renderAnimals(){animalsListDiv.innerHTML=''; userData.animals.forEach(a=>{const span=document.createElement('span'); span.className='animal'; if(a==='Vacă') span.textContent='🐄'; if(a==='Găină') span.textContent='🐔'; if(a==='Câine') span.textContent='🐕'; if(a==='Pisică') span.textContent='🐈'; animalsListDiv.appendChild(span); span.style.left=Math.random()*plotsDiv.offsetWidth+'px'; span.style.top=Math.random()*plotsDiv.offsetHeight+'px'; setInterval(()=>{span.style.left=Math.random()*plotsDiv.offsetWidth+'px'; span.style.top=Math.random()*plotsDiv.offsetHeight+'px';},2000);});}
function updateResourceUI(){grainCount.textContent=userData.grain; vegCount.textContent=userData.veg; fruitCount.textContent=userData.fruit; coinsCount.textContent=userData.coins;}
function saveUserData(){const users=loadUsers(); if(!currentUser) return; users[currentUser]=JSON.parse(JSON.stringify(userData)); saveUsers(users);}
function //=== Animatii Hoți, Tractoare, Paznici (fără pești) ===

function spawnThief(){
  const thief=document.createElement('span');
  thief.className='thief';
  thief.textContent='🦹';
  document.body.appendChild(thief);
  thief.style.left=Math.random()*(window.innerWidth-30)+'px';
  thief.style.top=Math.random()*(window.innerHeight-30)+'px';
  setTimeout(()=>{thief.remove();},5000);
}
setInterval(spawnThief,8000);

function renderGuards(){
  let guardDiv=document.getElementById('guards');
  if(!guardDiv){
    guardDiv=document.createElement('div');
    guardDiv.id='guards';
    document.body.appendChild(guardDiv);
  }
  guardDiv.innerHTML='';
  for(let i=0;i<2;i++){
    const g=document.createElement('span');
    g.className='guard';
    g.textContent='🛡️';
    guardDiv.appendChild(g);
    g.style.left=Math.random()*window.innerWidth+'px';
    g.style.top=Math.random()*window.innerHeight+'px';
    setInterval(()=>{
      g.style.left=Math.random()*window.innerWidth+'px';
      g.style.top=Math.random()*window.innerHeight+'px';
    },2000);
  }
}
renderGuards();

const harvester=document.createElement('div');harvester.className='harvester';document.body.appendChild(harvester);
const seeder=document.createElement('div');seeder.className='seeder';document.body.appendChild(seeder);

function moveHarvester(){
  const plots=document.querySelectorAll('.plot.ready');
  if(plots.length===0) return;
  const target=plots[Math.floor(Math.random()*plots.length)];
  const idx=Array.from(plotsDiv.children).indexOf(target);
  const rect=target.getBoundingClientRect();
  harvester.style.left=rect.left+'px';
  harvester.style.top=rect.top+'px';
  setTimeout(()=>{
    const plotData=userData.plots[idx];
    if(plotData && plotData.ready){
      if(plotData.type==='Grâu') userData.grain+=1;
      if(plotData.type==='Legume') userData.veg+=1;
      if(plotData.type==='Fructe') userData.fruit+=1;
      userData.coins+=1;
      plotData.type=null; plotData.ready=false; plotData.plantedAt=null;
      saveUserData(); updateResourceUI(); renderFarm();
    }
  },500);
}

function moveSeeder(){
  const plots=document.querySelectorAll('.plot:not(.planted)');
  if(plots.length===0) return;
  const target=plots[Math.floor(Math.random()*plots.length)];
  const idx=Array.from(plotsDiv.children).indexOf(target);
  const rect=target.getBoundingClientRect();
  seeder.style.left=rect.left+'px';
  seeder.style.top=rect.top+'px';
  setTimeout(()=>{
    const plotData=userData.plots[idx];
    if(plotData && !plotData.type){
      const choices=['Grâu','Legume','Fructe'];
      const choice=choices[Math.floor(Math.random()*choices.length)];
      plotData.type=choice;
      plotData.plantedAt=Date.now();
      plotData.ready=false;
      saveUserData();
      renderFarm();
    }
  },500);
}

setInterval(moveHarvester,3000);
setInterval(moveSeeder,5000);

//=== Animatia animalelor cu interval global ===
function animateAnimals(){
  const animals=document.querySelectorAll('.animal');
  animals.forEach(a=>{
    a.style.left=Math.random()*plotsDiv.offsetWidth+'px';
    a.style.top=Math.random()*plotsDiv.offsetHeight+'px';
  });
}
setInterval(animateAnimals,2000);

function renderAnimals(){
  animalsListDiv.innerHTML='';
  userData.animals.forEach(a=>{
    const span=document.createElement('span'); 
    span.className='animal';
    if(a==='Vacă') span.textContent='🐄';
    if(a==='Găină') span.textContent='🐔';
    if(a==='Câine') span.textContent='🐕';
    if(a==='Pisică') span.textContent='🐈';
    animalsListDiv.appendChild(span);
    // poziționare inițială
    span.style.left=Math.random()*plotsDiv.offsetWidth+'px';
    span.style.top=Math.random()*plotsDiv.offsetHeight+'px';
  });
}

